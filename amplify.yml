version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        # Server-only envs (available to server code; not exposed to client)
        - printf "SUPABASE_URL=%s\n" "$SUPABASE_URL" >> .env.production
        - printf "SUPABASE_SERVICE_ROLE_KEY=%s\n" "$SUPABASE_SERVICE_ROLE_KEY" >> .env.production
        - printf "DISCORD_INVITE_URL=%s\n" "$DISCORD_INVITE_URL" >> .env.production
        # Client envs (only those starting with NEXT_PUBLIC_ will be exposed to the browser)
        - env | grep -E '^NEXT_PUBLIC_' >> .env.production || true
        # Build
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
